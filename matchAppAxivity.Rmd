---
title: "Agreement My Little Moves App and Accelerometers"
author: "Annelinde Lettink"
date: "10/12/2023"
output:
  pdf_document: default
  html_document: default
---

This document presents the output of the data synchronization between the My Little Moves app and accelerometer data.

```{r setup, echo=FALSE}
rm(list = ls())
gc()
knitr::opts_chunk$set(echo = TRUE)
date <- "20231010" # Date 
tz = "Europe/Amsterdam"
# Use preprocessed Axivity data (data without non-wear)
filepath.hip <- "/Users/annelindelettink/Documents/Work MacBook Pro Annelinde/My Little Moves (MLM)/Accelerometer data/Measurement1/5sec/epochdata/hip/nonwear_removed"
filepath.wrist <- "/Users/annelindelettink/Documents/Work MacBook Pro Annelinde/My Little Moves (MLM)/Accelerometer data/Measurement1/5sec/epochdata/wrist/nonwear_removed"
# Use app data activities
filepath.app <- "/Users/annelindelettink/Documents/Work MacBook Pro Annelinde/My Little Moves (MLM)/App-data/20230918"
filename.app <- "/20230918_activities_castor_linked_duration.csv"
filename.app.day <- "/20230918_MLMapp_pp_duration_frequency_day.csv"
# Path to directory to save the data list
savedir <- "/Users/annelindelettink/Documents/Work MacBook Pro Annelinde/My Little Moves (MLM)/Comparison MLM-app and accelerometer data/Analyses/output"

# source functions directly from file, to be replaced by package installation:
my_functions_folder =   "/Users/annelindelettink/Documents/Work MacBook Pro Annelinde/My Little Moves (MLM)/Comparison MLM-app and accelerometer data/Analyses/AxivityMLMapp/R"
for (function_file in dir(my_functions_folder, full.names = T)) source(function_file) #load functions

## Load data
data.app <- load.app(filepath.app, filename.app, cohort = c(3), measurementperiod = 1, sep = ",") # Load app data
data.app.day <- read.csv(paste0(filepath.app, filename.app.day))[,-1] # Load app data/day
data.app.day <- data.app.day[which(data.app.day$castorID %in% unique(data.app$castorID)),]
data.app.day <- data.app.day[which(data.app.day$measurement == 1),]

rm(filepath.app, filename.app, my_functions_folder, function_file)
# Set up for plots
level_order <- c("actiefverplaatsen", "passiefverplaatsen", "actiefspelen", "rustigspelen", "weetnietspelen", 
                 "actiefbeeldscherm", "passiefbeeldscherm", "zittenliggen", "etendrinken", 
                 "verzorging", "slapen", "iemandanders", "other", "weetniet")
labels_EN <- c("Active transport", "Passive transport", "Active play", "Quiet play", "Don't know play",
               "Active screen use", "Passive screen use", "Sitting/lying", "Eating/drinking",
               "Personal care", "Sleeping", "Child was with someone else", "Other activity", "I don't know")
```

```{r Match data and prepare for further analyses and plots, include=FALSE}
## Match axivity data to app entries
#run L36 once: then load in data from saved file
#data.app.axivity <- match.app.axivity(data.app, filepath.hip, filepath.wrist, tz, date)
load("/Users/annelindelettink/Documents/Work MacBook Pro Annelinde/My Little Moves (MLM)/Comparison MLM-app and accelerometer data/Analyses/output/app_ax_entry_20231010.RData")
rm(filepath.hip, filepath.wrist, tz)
# From gravitational units in g to mg
data.app.axivity <- data.pp
data.app.axivity$ENMO.hip <- data.app.axivity$ENMO.hip * 1000
data.app.axivity$ENMO.wrist <- data.app.axivity$ENMO.wrist * 1000
data.app.axivity$MAD.hip <- data.app.axivity$MAD.hip * 1000
data.app.axivity$MAD.wrist <- data.app.axivity$MAD.wrist * 1000
rm(data.pp)
# Combine data for both placements
#data.app.axivity$ENMO.both = data.app.axivity$ENMO.hip * data.app.axivity$ENMO.wrist 
#data.app.axivity$MAD.both = data.app.axivity$MAD.hip * data.app.axivity$MAD.wrist 

# Reshape data to long format
df_long <- tidyr::gather(data.app.axivity, metric, value, ENMO.hip:MAD.wrist)
#df_long <- tidyr::gather(data.app.axivity, metric, value, ENMO.hip:MAD.both)
df_long.ENMO <- df_long[which(startsWith(df_long$metric, "ENMO")),]
df_long.MAD <- df_long[which(startsWith(df_long$metric, "MAD")),]

## Calculate metrics per day per activity
df_long_activity_ENMOhip <- data.frame(matrix(NA, nrow = length(unique(data.app.axivity$castorID))*7, 
                                     ncol = 4 + length(unique(data.app.axivity$activity))))
df_long_activity_ENMOwrist <- df_long_activity_ENMOhip
df_long_activity_MADhip <- df_long_activity_ENMOhip
df_long_activity_MADwrist <- df_long_activity_ENMOhip
names <- c("castorID", "cohort", "date", "measurement", unique(data.app.axivity$activity))
colnames(df_long_activity_ENMOhip) <- names
colnames(df_long_activity_ENMOwrist) <- names
colnames(df_long_activity_MADhip) <- names
colnames(df_long_activity_MADwrist) <- names

df_long_behavior_ENMOhip <- data.frame(matrix(NA, nrow = length(unique(data.app.axivity$castorID))*7, 
                                     ncol = 4 + length(unique(data.app.axivity$behavior))))
df_long_behavior_ENMOwrist <- df_long_behavior_ENMOhip
df_long_behavior_MADhip <- df_long_behavior_ENMOhip
df_long_behavior_MADwrist <- df_long_behavior_ENMOhip
names <- c("castorID", "cohort", "date", "measurement", unique(data.app.axivity$behavior))
colnames(df_long_behavior_ENMOhip) <- names
colnames(df_long_behavior_ENMOwrist) <- names
colnames(df_long_behavior_MADhip) <- names
colnames(df_long_behavior_MADwrist) <- names

counter = 1

for (m in 1:length(unique(data.app.axivity$measurement))){
  data_m <- data.app.axivity[data.app.axivity$measurement == unique(data.app.axivity$measurement)[m],]
  for(pp in 1:length(unique(data_m$castorID))){
  data_pp <- data_m[data_m$castorID == unique(data_m$castorID)[pp],]
  days <- unique(data_pp$date)
  for (day in 1:length(days)){
    df_long_activity_ENMOhip$castorID[counter] <- unique(data_pp$castorID)
    df_long_activity_ENMOhip$cohort[counter] <- unique(data_pp$cohort)
    df_long_activity_ENMOhip$measurement[counter] <- unique(data_pp$measurement)
    df_long_activity_ENMOhip$date[counter] <- days[day]
    df_long_activity_ENMOwrist[counter,] <- df_long_activity_ENMOhip[counter,]
    df_long_activity_MADhip[counter,] <- df_long_activity_ENMOhip[counter,]
    df_long_activity_MADwrist[counter,] <- df_long_activity_ENMOhip[counter,]
    df_long_behavior_ENMOhip$castorID[counter] <- unique(data_pp$castorID)
    df_long_behavior_ENMOhip$cohort[counter] <- unique(data_pp$cohort)
    df_long_behavior_ENMOhip$measurement[counter] <- unique(data_pp$measurement)
    df_long_behavior_ENMOhip$date[counter] <- days[day]
    df_long_behavior_ENMOwrist[counter,] <- df_long_behavior_ENMOhip[counter,]
    df_long_behavior_MADhip[counter,] <- df_long_behavior_ENMOhip[counter,]
    df_long_behavior_MADwrist[counter,] <- df_long_behavior_ENMOhip[counter,]

    tmp <-   data_pp[data_pp$date == days[day],]
    activities <- unique(tmp$activity)
    for(a in 1:length(activities)){
      act <- tmp[tmp$activity == activities[a],]
      df_long_activity_ENMOhip[counter,which(colnames(df_long_activity_ENMOhip) == activities[a])] <- median(act$ENMO.hip, na.rm = TRUE)
      df_long_activity_ENMOwrist[counter,which(colnames(df_long_activity_ENMOwrist) == activities[a])] <- median(act$ENMO.wrist, na.rm = TRUE)
      df_long_activity_MADhip[counter,which(colnames(df_long_activity_MADhip) == activities[a])] <- median(act$MAD.hip, na.rm = TRUE)
      df_long_activity_MADwrist[counter,which(colnames(df_long_activity_MADwrist) == activities[a])] <- median(act$MAD.wrist, na.rm = TRUE)
      
      behavior <- unique(act$behavior)
      for(b in 1:length(behavior)){
        df_long_behavior_ENMOhip[counter,which(colnames(df_long_behavior_ENMOhip) == behavior[b])] <- median(act$ENMO.hip, na.rm = TRUE)
      df_long_behavior_ENMOwrist[counter,which(colnames(df_long_behavior_ENMOwrist) == behavior[b])] <- median(act$ENMO.wrist, na.rm = TRUE)
      df_long_behavior_MADhip[counter,which(colnames(df_long_behavior_MADhip) == behavior[b])] <- median(act$MAD.hip, na.rm = TRUE)
      df_long_behavior_MADwrist[counter,which(colnames(df_long_behavior_MADwrist) ==  behavior[b])] <- median(act$MAD.wrist, na.rm = TRUE)
      }
    }
  counter = counter + 1  
  }
}
}
df_long_activity_ENMOhip<- df_long_activity_ENMOhip[-which(is.na(df_long_activity_ENMOhip$castorID)),]
df_long_activity_ENMOwrist<- df_long_activity_ENMOwrist[-which(is.na(df_long_activity_ENMOwrist$castorID)),]
df_long_activity_MADhip<- df_long_activity_MADhip[-which(is.na(df_long_activity_MADhip$castorID)),]
df_long_activity_MADwrist<- df_long_activity_MADwrist[-which(is.na(df_long_activity_MADwrist$castorID)),]
df_long_behavior_ENMOhip<- df_long_behavior_ENMOhip[-which(is.na(df_long_behavior_ENMOhip$castorID)),]
df_long_behavior_ENMOwrist<- df_long_behavior_ENMOwrist[-which(is.na(df_long_behavior_ENMOwrist$castorID)),]
df_long_behavior_MADhip<- df_long_behavior_MADhip[-which(is.na(df_long_behavior_MADhip$castorID)),]
df_long_behavior_MADwrist<- df_long_behavior_MADwrist[-which(is.na(df_long_behavior_MADwrist$castorID)),]
 
# df_long_activity_ENMOhip$metric <- as.factor(rep("ENMO", nrow(df_long_activity_ENMOhip)))
# df_long_activity_ENMOhip$placement <- as.factor(rep("hip", nrow(df_long_activity_ENMOhip)))
# df_long_activity_ENMOwrist$metric <- as.factor(rep("ENMO", nrow(df_long_activity_ENMOwrist)))
# df_long_activity_ENMOwrist$placement <- as.factor(rep("wrist", nrow(df_long_activity_ENMOwrist)))
# df_long_activity_MADhip$metric <- as.factor(rep("MAD", nrow(df_long_activity_MADhip)))
# df_long_activity_MADhip$placement <- as.factor(rep("hip", nrow(df_long_activity_MADhip)))
# df_long_activity_MADwrist$metric <- as.factor(rep("MAD", nrow(df_long_activity_MADwrist)))
# df_long_activity_MADwrist$placement <- as.factor(rep("wrist", nrow(df_long_activity_MADwrist)))
# 
# df_long_activity <- rbind(df_long_activity_ENMOhip, df_long_activity_ENMOwrist, df_long_activity_MADhip, df_long_activity_MADwrist)

long_ENMOhip <- data.table::melt(df_long_activity_ENMOhip, id.vars = c("castorID", "date", "cohort", "measurement"), variable.name = "activity")
long_ENMOwrist <- data.table::melt(df_long_activity_ENMOwrist, id.vars = c("castorID", "date", "cohort", "measurement"), variable.name = "activity")
long_MADhip <- data.table::melt(df_long_activity_MADhip, id.vars = c("castorID", "date", "cohort", "measurement"), variable.name = "activity")
long_MADwrist <- data.table::melt(df_long_activity_MADwrist, id.vars = c("castorID", "date", "cohort", "measurement"), variable.name = "activity")

 # write.csv(df_long_activity_metrics, paste0(savedir, "/", date, "_app.ax.long_activity.csv"))
#  write.csv(df_long_behavior_metrics, paste0(savedir, "/", date, "_app.ax.long_behavior.csv"))

```


### Overlay plot
```{r Overlay plots}

for(pp in 1:length(unique(data.app.day$castorID))){
  create.overlayplot(data.app, filepath.hip, filepath.wrist, data.app.day$castorID[pp], savedir)
}

```


### Descriptive statistics
## Per activity category

This section presents the results per activity category.

```{r Descriptive statistics category, echo=FALSE}
library(dplyr)
desc_day_enmohip <- long_ENMOhip %>% 
  group_by(activity) %>% 
    summarize(M = median(value, na.rm = TRUE),
            LL = quantile(value, .25, na.rm = TRUE),
            UL = quantile(value, .75, na.rm = TRUE),
            )
desc_day_enmohip

desc_day_madhip <- long_MADhip %>% 
  group_by(activity) %>% 
    summarize(M = median(value, na.rm = TRUE),
            LL = quantile(value, .25, na.rm = TRUE),
            UL = quantile(value, .75, na.rm = TRUE),
            )
desc_day_madhip

library(dplyr)
desc_day_enmowrist <- long_ENMOwrist %>% 
  group_by(activity) %>% 
    summarize(M = median(value, na.rm = TRUE),
            LL = quantile(value, .25, na.rm = TRUE),
            UL = quantile(value, .75, na.rm = TRUE),
            )
desc_day_enmowrist

desc_day_madwrist <- long_MADwrist %>% 
  group_by(activity) %>% 
    summarize(M = median(value, na.rm = TRUE),
            LL = quantile(value, .25, na.rm = TRUE),
            UL = quantile(value, .75, na.rm = TRUE),
            )
desc_day_madwrist

#Load app data /day statistics
desc_categories_Freq <- summary(aggregate(data.app.day[,22:36], by=list(data.app.day$castorID),  FUN=mean, na.rm=TRUE))
desc_categories_time <- summary(aggregate(data.app.day[,7:21], by=list(data.app.day$castorID),  FUN=mean, na.rm=TRUE))
```

```{r Boxplot categories, echo=FALSE}
bxp_ENMO <- create.boxplot(data_long = df_long.ENMO, metric = "ENMO", per = "activity", order_categories = level_order)
bxp_ENMO
bxp_MAD <- create.boxplot(data_long = df_long.MAD, metric = "MAD", per = "activity", order_categories = level_order)
bxp_MAD

combine.save.plots(bxp_ENMO, bxp_MAD, format = "boxplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "boxplot_categories.png")
```

```{r Density plots categories, echo = FALSE}
density_ENMO.hip <- create.densityplot(data = data.app.axivity, metric = "ENMO", placement = "hip", per = "activity", order_categories = level_order)
plot(density_ENMO.hip)
density_ENMO.wrist <- create.densityplot(data = data.app.axivity, metric = "ENMO", placement = "wrist", per = "activity", order_categories = level_order)
plot(density_ENMO.wrist)
combine.save.plots(density_ENMO.hip, density_ENMO.wrist, format = "densityplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "density_ENMO_categories.png")

density_MAD.hip <- create.densityplot(data = data.app.axivity, metric = "MAD", placement = "hip", per = "activity", order_categories = level_order)
plot(density_MAD.hip)
density_MAD.wrist <- create.densityplot(data = data.app.axivity, metric = "MAD", placement = "wrist", per = "activity", order_categories = level_order)
plot(density_MAD.wrist)
combine.save.plots(density_MAD.hip, density_MAD.wrist, format = "densityplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "density_MAD_categories.png")
```

# Descriptive statistics within categories per posture

```{r Descriptive statistics active play posture, echo=FALSE}
library(dplyr)
data.app.axivity.posture <- data.app.axivity[data.app.axivity$activity %in% c("actiefspelen", "rustigspelen", "weetnietspelen", "zittenliggen"),]

desc_categories.posture <- data.app.axivity %>% 
  group_by(activity, posture) %>% 
  summarize(Mduration = median(total_duration),
            LL = quantile(total_duration, .25),
            UL = quantile(total_duration, .75),
            Menmo.hip = median(ENMO.hip, na.rm = TRUE),
            LLenmo.hip = quantile(ENMO.hip, .25, na.rm = TRUE),
            ULenmo.hip = quantile(ENMO.hip, .75, na.rm = TRUE),
            Menmo.wrist = median(ENMO.wrist, na.rm = TRUE),
            LLenmo.wrist = quantile(ENMO.wrist, .25, na.rm = TRUE),
            ULenmo.wrist = quantile(ENMO.wrist, .75, na.rm = TRUE),
            Mmad.hip = median(MAD.hip, na.rm = TRUE),
            LLmad.hip = quantile(MAD.hip, .25, na.rm = TRUE),
            ULmad.hip = quantile(MAD.hip, .75, na.rm = TRUE),
            Mmad.wrist = median(MAD.wrist, na.rm = TRUE),
            LLmad.wrist = quantile(MAD.wrist, .25, na.rm = TRUE),
            ULmad.wrist = quantile(MAD.wrist, .75, na.rm = TRUE),
            n = n(), 
            ) %>% 
            mutate(percent = n / sum(n)*100)
desc_categories.posture
```

# Sitting/lying
```{r Plot postures sitting/lying, echo = FALSE}
# Zitten liggen
df_long.ENMO.sittinglying <- df_long.ENMO[df_long.ENMO$activity=="zittenliggen",]
df_long.MAD.sittinglying <- df_long.MAD[df_long.MAD$activity=="zittenliggen",]
data.app.axivity.sittinglying <- data.app.axivity[data.app.axivity$activity=="zittenliggen",]

#Boxplot
bxp_ENMO.sit <- create.boxplot(data_long = df_long.ENMO.sittinglying, metric = "ENMO", per = "posture", order_categories = names(df_long.ENMO.sittinglying$posture))
bxp_MAD.sit <- create.boxplot(data_long = df_long.MAD.sittinglying, metric = "MAD", per = "posture", order_categories = names(df_long.MAD.sittinglying$posture))
combine.save.plots(bxp_ENMO.sit, bxp_MAD.sit, format = "boxplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "boxplot_sittinglying_postures.png")

#Scatterplots
scatter_ENMO.hip.sit <- create.scatterplot(data = data.app.axivity.sittinglying, metric = "ENMO", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.sittinglying$posture))
plot(scatter_ENMO.hip.sit)
scatter_ENMO.wrist.sit <- create.scatterplot(data = data.app.axivity.sittinglying, metric = "ENMO", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.sittinglying$posture))
plot(scatter_ENMO.wrist.sit)
combine.save.plots(scatter_ENMO.hip.sit, scatter_ENMO.wrist.sit, format = "scatterplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "scatter_ENMO_sittinglying_postures.png")

scatter_MAD.hip.sit <- create.scatterplot(data = data.app.axivity.sittinglying, metric = "MAD", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.sittinglying$posture))
plot(scatter_MAD.hip.sit)
scatter_MAD.wrist.sit <- create.scatterplot(data = data.app.axivity.sittinglying, metric = "MAD", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.sittinglying$posture))
plot(scatter_MAD.wrist.sit)
combine.save.plots(scatter_MAD.hip.sit, scatter_MAD.wrist.sit, format = "scatterplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "scatter_MAD_sittinglying_postures.png")

#Density plots
density_ENMO.hip.sit <- create.densityplot(data = data.app.axivity.sittinglying, metric = "ENMO", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.sittinglying$posture))
plot(density_ENMO.hip.sit)
density_ENMO.wrist.sit <- create.densityplot(data = data.app.axivity.sittinglying, metric = "ENMO", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.sittinglying$posture))
plot(density_ENMO.wrist.sit)
combine.save.plots(density_ENMO.hip.sit, density_ENMO.wrist.sit, format = "densityplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "density_ENMO_sittinglying_postures.png")

density_MAD.hip.sit <- create.densityplot(data = data.app.axivity.sittinglying, metric = "MAD", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.sittinglying$posture))
plot(density_MAD.hip.sit)
density_MAD.wrist.sit <- create.densityplot(data = data.app.axivity.sittinglying, metric = "MAD", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.sittinglying$posture))
plot(density_MAD.wrist.sit)
combine.save.plots(density_MAD.hip.sit, density_MAD.wrist.sit, format = "densityplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "density_MAD_sittinglying_postures.png")
```

# Active play

```{r Plot postures active play, echo = FALSE}
# Zitten liggen
df_long.ENMO.activeplay <- df_long.ENMO[df_long.ENMO$activity=="actiefspelen",]
df_long.MAD.activeplay <- df_long.MAD[df_long.MAD$activity=="actiefspelen",]
data.app.axivity.activeplay <- data.app.axivity[data.app.axivity$activity=="actiefspelen",]

#Boxplot
bxp_ENMO.aplay <- create.boxplot(data_long = df_long.ENMO.activeplay, metric = "ENMO", per = "posture", order_categories = names(df_long.ENMO.activeplay$posture))
bxp_MAD.aplay <- create.boxplot(data_long = df_long.MAD.activeplay, metric = "MAD", per = "posture", order_categories = names(df_long.MAD.activeplay$posture))
combine.save.plots(bxp_ENMO.aplay, bxp_MAD.aplay, format = "boxplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "boxplot_activeplay_postures.png")

#Scatterplots
scatter_ENMO.hip.aplay <- create.scatterplot(data = data.app.axivity.activeplay, metric = "ENMO", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.activeplay$posture))
plot(scatter_ENMO.hip.aplay)
scatter_ENMO.wrist.aplay <- create.scatterplot(data = data.app.axivity.activeplay, metric = "ENMO", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.activeplay$posture))
plot(scatter_ENMO.wrist.aplay)
combine.save.plots(scatter_ENMO.hip.aplay, scatter_ENMO.wrist.aplay, format = "scatterplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "scatter_ENMO_activeplay_postures.png")

scatter_MAD.hip.aplay <- create.scatterplot(data = data.app.axivity.activeplay, metric = "MAD", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.activeplay$posture))
plot(scatter_MAD.hip.aplay)
scatter_MAD.wrist.aplay <- create.scatterplot(data = data.app.axivity.activeplay, metric = "MAD", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.activeplay$posture))
plot(scatter_MAD.wrist.aplay)
combine.save.plots(scatter_MAD.hip.aplay, scatter_MAD.wrist.aplay, format = "scatterplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "scatter_MAD_activeplay_postures.png")

#Density plots
density_ENMO.hip.aplay <- create.densityplot(data = data.app.axivity.activeplay, metric = "ENMO", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.activeplay$posture))
plot(density_ENMO.hip.aplay)
density_ENMO.wrist.aplay <- create.densityplot(data = data.app.axivity.activeplay, metric = "ENMO", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.activeplay$posture))
plot(density_ENMO.wrist.aplay)
combine.save.plots(density_ENMO.hip.aplay, density_ENMO.wrist.aplay, format = "densityplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "density_ENMO_activeplay_postures.png")

density_MAD.hip.aplay <- create.densityplot(data = data.app.axivity.activeplay, metric = "MAD", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.activeplay$posture))
plot(density_MAD.hip.aplay)
density_MAD.wrist.aplay <- create.densityplot(data = data.app.axivity.activeplay, metric = "MAD", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.activeplay$posture))
plot(density_MAD.wrist.aplay)
combine.save.plots(density_MAD.hip.sit, density_MAD.wrist.aplay, format = "densityplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "density_MAD_activeplay_postures.png")
```

# Quiet play

```{r Plot postures quiet play, echo = FALSE}
# Zitten liggen
df_long.ENMO.quietplay <- df_long.ENMO[df_long.ENMO$activity=="rustigspelen",]
df_long.MAD.quietplay <- df_long.MAD[df_long.MAD$activity=="rustigspelen",]
data.app.axivity.quietplay <- data.app.axivity[data.app.axivity$activity=="rustigspelen",]

#Boxplot
bxp_ENMO.qplay <- create.boxplot(data_long = df_long.ENMO.quietplay, metric = "ENMO", per = "posture", order_categories = names(df_long.ENMO.quietplay$posture))
bxp_MAD.qplay <- create.boxplot(data_long = df_long.MAD.quietplay, metric = "MAD", per = "posture", order_categories = names(df_long.MAD.quietplay$posture))
combine.save.plots(bxp_ENMO.qplay, bxp_MAD.qplay, format = "boxplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "boxplot_quietplay_postures.png")

#Scatterplots
scatter_ENMO.hip.qplay <- create.scatterplot(data = data.app.axivity.quietplay, metric = "ENMO", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.quietplay$posture))
plot(scatter_ENMO.hip.qplay)
scatter_ENMO.wrist.qplay <- create.scatterplot(data = data.app.axivity.quietplay, metric = "ENMO", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.quietplay$posture))
plot(scatter_ENMO.wrist.qplay)
combine.save.plots(scatter_ENMO.hip.qplay, scatter_ENMO.wrist.qplay, format = "scatterplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "scatter_ENMO_quietplay_postures.png")

scatter_MAD.hip.qplay <- create.scatterplot(data = data.app.axivity.quietplay, metric = "MAD", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.quietplay$posture))
plot(scatter_MAD.hip.qplay)
scatter_MAD.wrist.qplay <- create.scatterplot(data = data.app.axivity.quietplay, metric = "MAD", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.quietplay$posture))
plot(scatter_MAD.wrist.qplay)
combine.save.plots(scatter_MAD.hip.qplay, scatter_MAD.wrist.qplay, format = "scatterplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "scatter_MAD_quietplay_postures.png")

#Density plots
density_ENMO.hip.qplay <- create.densityplot(data = data.app.axivity.quietplay, metric = "ENMO", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.quietplay$posture))
plot(density_ENMO.hip.qplay)
density_ENMO.wrist.qplay <- create.densityplot(data = data.app.axivity.quietplay, metric = "ENMO", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.quietplay$posture))
plot(density_ENMO.wrist.qplay)
combine.save.plots(density_ENMO.hip.qplay, density_ENMO.wrist.qplay, format = "densityplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "density_ENMO_quietplay_postures.png")

density_MAD.hip.qplay <- create.densityplot(data = data.app.axivity.quietplay, metric = "MAD", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.quietplay$posture))
plot(density_MAD.hip.qplay)
density_MAD.wrist.qplay <- create.densityplot(data = data.app.axivity.quietplay, metric = "MAD", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.quietplay$posture))
plot(density_MAD.wrist.qplay)
combine.save.plots(density_MAD.hip.sit, density_MAD.wrist.qplay, format = "densityplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "density_MAD_quietplay_postures.png")
```

# Don't know play

```{r Plot postures dont know play, echo = FALSE}
# Zitten liggen
df_long.ENMO.dontknowplay <- df_long.ENMO[df_long.ENMO$activity=="weetnietspelen",]
df_long.MAD.dontknowplay <- df_long.MAD[df_long.MAD$activity=="weetnietspelen",]
data.app.axivity.dontknowplay <- data.app.axivity[data.app.axivity$activity=="weetnietspelen",]

#Boxplot
bxp_ENMO.dplay <- create.boxplot(data_long = df_long.ENMO.dontknowplay, metric = "ENMO", per = "posture", order_categories = names(df_long.ENMO.dontknowplay$posture))
bxp_MAD.dplay <- create.boxplot(data_long = df_long.MAD.dontknowplay, metric = "MAD", per = "posture", order_categories = names(df_long.MAD.dontknowplay$posture))
combine.save.plots(bxp_ENMO.dplay, bxp_MAD.dplay, format = "boxplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "boxplot_dontknowplay_postures.png")

#Scatterplots
scatter_ENMO.hip.dplay <- create.scatterplot(data = data.app.axivity.dontknowplay, metric = "ENMO", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.dontknowplay$posture))
plot(scatter_ENMO.hip.dplay)
scatter_ENMO.wrist.dplay <- create.scatterplot(data = data.app.axivity.dontknowplay, metric = "ENMO", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.dontknowplay$posture))
plot(scatter_ENMO.wrist.dplay)
combine.save.plots(scatter_ENMO.hip.dplay, scatter_ENMO.wrist.dplay, format = "scatterplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "scatter_ENMO_dontknowplay_postures.png")

scatter_MAD.hip.dplay <- create.scatterplot(data = data.app.axivity.dontknowplay, metric = "MAD", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.dontknowplay$posture))
plot(scatter_MAD.hip.dplay)
scatter_MAD.wrist.dplay <- create.scatterplot(data = data.app.axivity.dontknowplay, metric = "MAD", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.dontknowplay$posture))
plot(scatter_MAD.wrist.dplay)
combine.save.plots(scatter_MAD.hip.dplay, scatter_MAD.wrist.dplay, format = "scatterplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "scatter_MAD_dontknowplay_postures.png")

#Density plots
density_ENMO.hip.dplay <- create.densityplot(data = data.app.axivity.dontknowplay, metric = "ENMO", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.dontknowplay$posture))
plot(density_ENMO.hip.dplay)
density_ENMO.wrist.dplay <- create.densityplot(data = data.app.axivity.dontknowplay, metric = "ENMO", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.dontknowplay$posture))
plot(density_ENMO.wrist.dplay)
combine.save.plots(density_ENMO.hip.dplay, density_ENMO.wrist.dplay, format = "densityplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "density_ENMO_dontknowplay_postures.png")

density_MAD.hip.dplay <- create.densityplot(data = data.app.axivity.dontknowplay, metric = "MAD", placement = "hip", per = "posture", order_categories = unique(data.app.axivity.dontknowplay$posture))
plot(density_MAD.hip.dplay)
density_MAD.wrist.dplay <- create.densityplot(data = data.app.axivity.dontknowplay, metric = "MAD", placement = "wrist", per = "posture", order_categories = unique(data.app.axivity.dontknowplay$posture))
plot(density_MAD.wrist.dplay)
combine.save.plots(density_MAD.hip.sit, density_MAD.wrist.dplay, format = "densityplots", savedir = paste0(savedir, "/plots/distributions/categories/"), filename = "density_MAD_dontknowplay_postures.png")
```
## Per movement behavior

This section presents the results per 24-h movement behavior.

```{r Descriptive statistics category 24h, echo=FALSE}
library(dplyr)
desc_behaviors <- data.app.axivity %>% 
  group_by(behavior) %>% 
  summarize(Mduration = median(total_duration),
            LL = quantile(total_duration, .25),
            UL = quantile(total_duration, .75),
            Menmo.hip = median(ENMO.hip, na.rm = TRUE),
            LLenmo.hip = quantile(ENMO.hip, .25, na.rm = TRUE),
            ULenmo.hip = quantile(ENMO.hip, .75, na.rm = TRUE),
            Menmo.wrist = median(ENMO.wrist, na.rm = TRUE),
            LLenmo.wrist = quantile(ENMO.wrist, .25, na.rm = TRUE),
            ULenmo.wrist = quantile(ENMO.wrist, .75, na.rm = TRUE),
            Mmad.hip = median(MAD.hip, na.rm = TRUE),
            LLmad.hip = quantile(MAD.hip, .25, na.rm = TRUE),
            ULmad.hip = quantile(MAD.hip, .75, na.rm = TRUE),
            Mmad.wrist = median(MAD.wrist, na.rm = TRUE),
            LLmad.wrist = quantile(MAD.wrist, .25, na.rm = TRUE),
            ULmad.wrist = quantile(MAD.wrist, .75, na.rm = TRUE),
            n = n(), 
            ) %>% 
            mutate(percent = n / sum(n)*100)
desc_behaviors
```

```{r Boxplot behaviors, echo=FALSE}
bxp_ENMO <- create.boxplot(data_long = df_long.ENMO, metric = "ENMO", per = "behavior", order_categories = c("PA", "SB", "sleep"))
bxp_ENMO
bxp_MAD <- create.boxplot(data_long = df_long.MAD, metric = "MAD", per = "behavior", order_categories = c("PA", "SB", "sleep"))
bxp_MAD

combine.save.plots(bxp_ENMO, bxp_MAD, format = "boxplots", savedir = paste0(savedir, "/plots/distributions/behaviors/"), filename = "boxplot_behaviors.png")
```
```{r Scatterplot behaviors, echo=FALSE}
scatter_ENMO.hip <- create.scatterplot(data = data.app.axivity, metric = "ENMO", placement = "hip", per = "behavior", order_categories = c("PA", "SB", "sleep", "NA"))
plot(scatter_ENMO.hip)
scatter_ENMO.wrist <- create.scatterplot(data = data.app.axivity, metric = "ENMO", placement = "wrist", per = "behavior", order_categories = c("PA", "SB", "sleep", "NA"))
plot(scatter_ENMO.wrist)
combine.save.plots(scatter_ENMO.hip, scatter_ENMO.wrist, format = "scatterplots", savedir = paste0(savedir, "/plots/distributions/behaviors/"), filename = "scatter_ENMO_behaviors.png")

scatter_MAD.hip <- create.scatterplot(data = data.app.axivity, metric = "MAD", placement = "hip", per = "behavior", order_categories = c("PA", "SB", "sleep", "NA"))
plot(scatter_MAD.hip)
scatter_MAD.wrist <- create.scatterplot(data = data.app.axivity, metric = "MAD", placement = "wrist", per = "behavior", order_categories = c("PA", "SB", "sleep", "NA"))
plot(scatter_MAD.wrist)
combine.save.plots(scatter_MAD.hip, scatter_MAD.wrist, format = "scatterplots", savedir = paste0(savedir, "/plots/distributions/behaviors/"), filename = "scatter_MAD_behaviors.png")
```

```{r Density plots behaviors, echo = FALSE}
density_ENMO.hip <- create.densityplot(data = data.app.axivity, metric = "ENMO", placement = "hip", per = "behavior", order_categories = c("PA", "SB", "sleep", "NA"))
plot(density_ENMO.hip)
density_ENMO.wrist <- create.densityplot(data = data.app.axivity, metric = "ENMO", placement = "wrist", per = "behavior", order_categories = c("PA", "SB", "sleep", "NA"))
plot(density_ENMO.wrist)
combine.save.plots(density_ENMO.hip, density_ENMO.wrist, format = "densityplots", savedir = paste0(savedir, "/plots/distributions/behaviors/"), filename = "density_ENMO_behaviors.png")

density_MAD.hip <- create.densityplot(data = data.app.axivity, metric = "MAD", placement = "hip", per = "behavior", order_categories = c("PA", "SB", "sleep", "NA"))
plot(density_MAD.hip)
density_MAD.wrist <- create.densityplot(data = data.app.axivity, metric = "MAD", placement = "wrist", per = "behavior", order_categories = c("PA", "SB", "sleep", "NA"))
plot(density_MAD.wrist)
combine.save.plots(density_MAD.hip, density_MAD.wrist, format = "densityplots", savedir = paste0(savedir, "/plots/distributions/behaviors/"), filename = "density_MAD_behaviors.png")
```

### Differences in acceleration 

## Hip placement

# ENMO

```{r Mixed model to asses differences in categories ENMO hip, echo = FALSE}
long_ENMOhip$castorID <- as.factor(long_ENMOhip$castorID)

acc_act <- glm(value ~ activity, data = long_ENMOhip)
acc_act_id <- lme4::glmer.nb(value ~ activity  + (1 | castorID), data = long_ENMOhip)

#acc_act_id <- lme4::glmer(value ~ activity  + (1 | castorID), data = long_ENMOhip) # Mixed models are robust when distribution assumption is violated, model estimates might be biased though https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13434
anova(acc_act, acc_act_id, test="Chisq")
rm(acc_act)
summary(acc_act_id)

maineffect_activity <- emmeans::emeans(acc_act_id, comparison="pairwise", 
                                         specs= ~ activity, adjust="sidak", data = long_ENMOhip, pbkrtest.limit = 3307)
maineffect_activity
emmeans::contrast(maineffect_activity, "pairwise", pbkrtest.limit = 3307)

# Other option is Zero-inflated poisson distribution
zipoisson <- glmmTMB::glmmTMB(as.integer(value+0.5) ~ activity,
                      data=long_ENMOhip,
                      ziformula=~1,
                      family=poisson)
zipoisson_id <- glmmTMB::glmmTMB(as.integer(value+0.5) ~ activity  + (1 | castorID),
                      data=long_ENMOhip,
                      ziformula=~1,
                      family=poisson)
anova(zipoisson, zipoisson_id, test="Chisq")
rm(zipoisson)
summary(zipoisson_id)

maineffect_activity_pois <- emmeans::emmeans(zipoisson_id, comparison="pairwise", 
                                         specs= ~ activity, adjust="sidak", data = long_ENMOhip, pbkrtest.limit = 3307)
maineffect_activity_pois
emmeans::contrast(maineffect_activity_pois, "pairwise", pbkrtest.limit = 3307)
```

# MAD

```{r Mixed model to asses differences in categories MAD hip, echo = FALSE}
long_MADhip$castorID <- as.factor(long_MADhip$castorID)
acc_act <- glm(value ~ activity, data = long_MADhip)
acc_act_id <- lme4::glmer.nb(value ~ activity  + (1 | castorID), data = long_MADhip)

#acc_act_id <- lme4::glmer(value ~ activity  + (1 | castorID), data = long_MADhip) # Mixed models are robust when distribution assumption is violated, model estimates might be biased though https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13434
anova(acc_act, acc_act_id, test="Chisq")
rm(acc_act)
summary(acc_act_id)

maineffect_activity <- emmeans::emmeans(acc_act_id, comparison="pairwise", 
                                         specs= ~ activity, adjust="sidak", data = long_MADhip, pbkrtest.limit = 3307)
maineffect_activity
emmeans::contrast(maineffect_activity, "pairwise", pbkrtest.limit = 3307)

# Other option is Zero-inflated poisson distribution
zipoisson <- glmmTMB::glmmTMB(as.integer(value+0.5) ~ activity,
                      data=long_MADhip,
                      ziformula=~1,
                      family=poisson)
zipoisson_id <- glmmTMB::glmmTMB(as.integer(value+0.5) ~ activity  + (1 | castorID),
                      data=long_MADhip,
                      ziformula=~1,
                      family=poisson)
anova(zipoisson, zipoisson_id, test="Chisq")
rm(zipoisson)
summary(zipoisson_id)

maineffect_activity_pois <- emmeans::emmeans(zipoisson_id, comparison="pairwise", 
                                         specs= ~ activity, adjust="sidak", data = long_MADhip, pbkrtest.limit = 3307)
maineffect_activity_pois
emmeans::contrast(maineffect_activity_pois, "pairwise", pbkrtest.limit = 3307)
```

## Wrist placement 

# ENMO

```{r Mixed model to asses differences in categories ENMO wrist, echo = FALSE}
long_ENMOwrist$castorID <- as.factor(long_ENMOwrist$castorID)
acc_act <- glm(value ~ activity, data = long_ENMOwrist)
acc_act_id <- lme4::glmer(value ~ activity  + (1 | castorID), data = long_ENMOwrist) # Mixed models are robust when distribution assumption is violated, model estimates might be biased though https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13434
anova(acc_act, acc_act_id, test="Chisq")
rm(acc_act)
summary(acc_act_id)

maineffect_activity <- emmeans::emmeans(acc_act_id, comparison="pairwise", 
                                         specs= ~ activity, adjust="sidak", data = long_ENMOwrist, pbkrtest.limit = 3307)
maineffect_activity
emmeans::contrast(maineffect_activity, "pairwise", pbkrtest.limit = 3307)

# Other option is Zero-inflated poisson distribution
zipoisson <- glmmTMB::glmmTMB(as.integer(value+0.5) ~ activity,
                      data=long_ENMOwrist,
                      ziformula=~1,
                      family=poisson)
zipoisson_id <- glmmTMB::glmmTMB(as.integer(value+0.5) ~ activity  + (1 | castorID),
                      data=long_ENMOwrist,
                      ziformula=~1,
                      family=poisson)
anova(zipoisson, zipoisson_id, test="Chisq")
rm(zipoisson)
summary(zipoisson_id)

maineffect_activity_pois <- emmeans::emmeans(zipoisson_id, comparison="pairwise", 
                                         specs= ~ activity, adjust="sidak", data = long_ENMOwrist, pbkrtest.limit = 3307)
maineffect_activity_pois
emmeans::contrast(maineffect_activity_pois, "pairwise", pbkrtest.limit = 3307)
```

# MAD

```{r Mixed model to asses differences in categories MAD hip, echo = FALSE}
long_MADhip$castorID <- as.factor(long_MADhip$castorID)
acc_act <- glm(value ~ activity, data = long_MADhip)
acc_act_id <- lme4::glmer(value ~ activity  + (1 | castorID), data = long_MADhip) # Mixed models are robust when distribution assumption is violated, model estimates might be biased though https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13434
anova(acc_act, acc_act_id, test="Chisq")
rm(acc_act)
summary(acc_act_id)

maineffect_activity <- emmeans::emmeans(acc_act_id, comparison="pairwise", 
                                         specs= ~ activity, adjust="sidak", data = long_MADhip, pbkrtest.limit = 3307)
maineffect_activity
emmeans::contrast(maineffect_activity, "pairwise", pbkrtest.limit = 3307)

# Other option is Zero-inflated poisson distribution
zipoisson <- glmmTMB::glmmTMB(as.integer(value+0.5) ~ activity,
                      data=long_MADhip,
                      ziformula=~1,
                      family=poisson)
zipoisson_id <- glmmTMB::glmmTMB(as.integer(value+0.5) ~ activity  + (1 | castorID),
                      data=long_MADhip,
                      ziformula=~1,
                      family=poisson)
anova(zipoisson, zipoisson_id, test="Chisq")
rm(zipoisson)
summary(zipoisson_id)

maineffect_activity_pois <- emmeans::emmeans(zipoisson_id, comparison="pairwise", 
                                         specs= ~ activity, adjust="sidak", data = long_MADhip, pbkrtest.limit = 3307)
maineffect_activity_pois
emmeans::contrast(maineffect_activity_pois, "pairwise", pbkrtest.limit = 3307)
```
